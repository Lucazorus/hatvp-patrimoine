<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO -->
  <title>Open Mandats — Outils de visualisation des participations financières et intérêts déclarés par les 547 députés de l'Assemblée Nationale</title>
  <meta name="description" content="Outils de visualisation des participations financières et intérêts déclarés par les 547 députés de l'Assemblée Nationale. Source : HATVP (Déclarations d'Intérêts et d'Activités), 17e législature.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://hatvp-patrimoine.fr/">

  <!-- Open Graph / réseaux sociaux -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Open Mandats">
  <meta property="og:description" content="Outils de visualisation des participations financières et intérêts déclarés par les 547 députés de l'Assemblée Nationale">
  <meta property="og:locale" content="fr_FR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Open Mandats">
  <meta name="twitter:description" content="Outils de visualisation des participations financières et intérêts déclarés par les 547 députés de l'Assemblée Nationale">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css?v=6">

  <!-- D3.js + Sankey plugin -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>

  <!-- Données embarquées (générées par fetch_data.py) -->
  <script src="data.js"></script>
  <script src="data_senateurs.js" onerror="window.HATVP_DATA_SENATEURS=null"></script>

</head>
<body>

<header>
  <div class="header-brand">
    <h1>Open Mandats</h1>
    <p id="header-desc">Participations financières et intérêts déclarés · Source : <a href="https://www.hatvp.fr/consulter-les-declarations/#open-data" target="_blank" rel="noopener">hatvp.fr</a></p>
  </div>
  <div class="header-right">
    <div class="dataset-toggle">
      <button class="dataset-btn active" data-ds="deputes" onclick="switchDataset('deputes',this)">Députés</button>
      <button class="dataset-btn" data-ds="senateurs" onclick="switchDataset('senateurs',this)">Sénateurs</button>
    </div>
    <button id="theme-toggle" onclick="toggleTheme()" title="Basculer mode clair / sombre">Mode clair</button>
  </div>
</header>

<!-- Barre sticky : toggle bourse + boutons partis + filtres actifs -->
<div id="sticky-bar">
  <div id="groupe-btns-bar" aria-label="Filtrer par groupe politique"></div>
  <div id="filter-bar" aria-live="polite">
    <span class="filter-bar-label">Filtres :</span>
    <div id="filter-bar-tags"></div>
  </div>
</div>

<main>


  <!-- Statistiques globales -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="value" id="stat-deputes">—</div>
      <div class="label" id="stat-deputes-label">Députés avec DIA publiée</div>
    </div>
    <div class="stat-card">
      <div class="value" id="stat-valeur">—</div>
      <div class="label">Valeur totale déclarée</div>
    </div>
    <div class="stat-card">
      <div class="value" id="stat-moyenne">—</div>
      <div class="label">Valeur moyenne déclarée</div>
    </div>
    <div class="stat-card">
      <div class="value" id="stat-mediane">—</div>
      <div class="label">Valeur médiane déclarée</div>
    </div>
  </div>

  <!-- Ligne 1 : grille 12 colonnes — bar valeur (3) + sunburst (9) -->
  <div class="grid-12" style="margin-bottom:14px">

    <div class="chart-card col-3">
      <h2 id="title-valeur-groupe">Valeur totale par groupe politique</h2>
      <p class="chart-subtitle">En millions d'euros · cliquer pour filtrer</p>
      <div class="chart-wrap" id="bar-valeur-groupe-wrap"></div>
    </div>

    <div class="chart-card col-9">
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:4px">
        <h2 style="margin:0;border:none;padding:0">Explorer : Groupes → Députés <small>(cliquez pour filtrer)</small></h2>
        <div class="explorer-toggle">
          <button class="explorer-btn active" onclick="switchExplorerView('sunburst',this)">Sunburst</button>
          <button class="explorer-btn" onclick="switchExplorerView('treemap',this)">Treemap</button>
          <button class="explorer-btn" onclick="switchExplorerView('sankey',this)">Sankey</button>
        </div>
      </div>
      <p class="chart-subtitle" id="explorer-subtitle">Anneau intérieur = groupe · anneau externe = député · surface ∝ valeur déclarée · double-clic pour zoomer</p>
      <div class="chart-wrap" id="sunburst-wrap" role="img" aria-label="Sunburst interactif"></div>
      <div class="chart-wrap" id="treemap-wrap" style="display:none"></div>
      <div id="sankey-inner" style="display:none">
        <div class="sankey-controls">
          <label>Top sociétés :
            <select id="sankey-top-n" onchange="rebuildSankey()">
              <option value="15">Top 15</option>
              <option value="25">Top 25</option>
              <option value="50">Top 50</option>
              <option value="9999" selected>Toutes</option>
            </select>
          </label>
          <label>Valeur min. par lien :
            <select id="sankey-min-val" onchange="rebuildSankey()">
              <option value="0" selected>Toutes</option>
              <option value="100000">≥ 100k€</option>
              <option value="500000">≥ 500k€</option>
              <option value="1000000">≥ 1M€</option>
              <option value="5000000">≥ 5M€</option>
            </select>
          </label>
          <label>Valeur max. par lien :
            <select id="sankey-max-val" onchange="rebuildSankey()">
              <option value="9999999999" selected>Toutes</option>
              <option value="5000000">≤ 5M€</option>
              <option value="1000000">≤ 1M€</option>
              <option value="500000">≤ 500k€</option>
              <option value="100000">≤ 100k€</option>
            </select>
          </label>
        </div>
        <div id="sankey-wrap"></div>
      </div>
    </div>

  </div>

  <!-- Sociétés + Table côte à côte -->
  <div class="split-layout">

    <div class="chart-card">
      <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:8px">
        <h2 id="title-societes" style="margin:0;flex:1;border:none;padding:0">Sociétés les plus détenues — valeur par groupe</h2>
        <div id="societes-picker" class="soc-picker">
          <div class="soc-picker-input-row">
            <input type="text" id="search-societes" class="search-input soc-picker-input"
                   placeholder="Filtrer une société..."
                   oninput="socPickerOnInput()"
                   onfocus="socPickerOpen()"
                   autocomplete="off"
                   style="width:200px;margin:0">
            <button class="soc-picker-clear" id="soc-picker-clear" onclick="socPickerClearAll()" title="Effacer la sélection" style="display:none">✕</button>
          </div>
          <ul class="soc-picker-dropdown" id="soc-picker-dropdown" style="display:none"></ul>
          <div class="soc-picker-tags" id="soc-picker-tags"></div>
        </div>
      </div>
      <p class="chart-subtitle" style="margin-top:6px">En millions d'euros · couleur = groupe politique · cliquer pour filtrer</p>
      <div style="height:1px;background:var(--border);margin-bottom:16px"></div>
      <div class="chart-wrap" id="bar-societes-wrap"></div>
    </div>

    <div class="table-card" id="table-section">
      <h2>
        Détail par député
        <input type="search" class="search-input" id="search" placeholder="Député, société..."
               aria-label="Rechercher un député ou une société">
      </h2>
      <p class="chart-subtitle">Cliquer sur l'en-tête d'une colonne pour trier · cliquer sur une ligne pour filtrer les graphiques</p>
      <div style="overflow-x:auto">
        <table>
          <thead id="table-head">
            <tr>
              <th onclick="sortTable('nom')">Député <span id="s-nom"></span></th>
              <th onclick="sortTable('groupe')">Groupe <span id="s-groupe"></span></th>
              <th onclick="sortTable('departement')">Dép. <span id="s-departement"></span></th>
              <th onclick="sortTable('nbParts')">Participations <span id="s-nbParts"></span></th>
              <th onclick="sortTable('valeurTotale')">Valeur totale <span id="s-valeurTotale"></span></th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
      <div class="pagination" id="pagination" role="navigation" aria-label="Pagination"></div>
      <p class="note">
        Sources :
        <a href="https://www.hatvp.fr/consulter-les-declarations/#open-data" target="_blank" rel="noopener">HATVP open data</a> ·
        <a href="https://www.assemblee-nationale.fr" target="_blank" rel="noopener">assemblee-nationale.fr</a> ·
        Uniquement les DIA publiées · "Données non publiées" = sociétés anonymisées par la HATVP
      </p>
    </div>

  </div>


</main>

<!-- Tooltip -->
<div id="tooltip" role="tooltip" aria-hidden="true"></div>

<!-- App -->
<script src="app.js?v=10" defer></script>
<script src="sankey.js?v=7" defer></script>

<!-- Analytics -->
<script data-goatcounter="https://lucazorus.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

</body>
</html>
