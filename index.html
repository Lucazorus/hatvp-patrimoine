<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- SEO -->
  <title>Participations financiÃ¨res des dÃ©putÃ©s â€” HATVP Open Data</title>
  <meta name="description" content="Visualisation interactive des participations financiÃ¨res et intÃ©rÃªts dans des entreprises dÃ©clarÃ©s par les dÃ©putÃ©s franÃ§ais. Source : HATVP (DÃ©clarations d'IntÃ©rÃªts et d'ActivitÃ©s), 17e lÃ©gislature.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://hatvp-patrimoine.fr/">

  <!-- Open Graph / rÃ©seaux sociaux -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Participations financiÃ¨res des dÃ©putÃ©s â€” HATVP">
  <meta property="og:description" content="Visualisation interactive des intÃ©rÃªts financiers dÃ©clarÃ©s par les 547 dÃ©putÃ©s franÃ§ais â€” donnÃ©es HATVP open data.">
  <meta property="og:locale" content="fr_FR">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Participations financiÃ¨res des dÃ©putÃ©s â€” HATVP">
  <meta name="twitter:description" content="Visualisation interactive des intÃ©rÃªts financiers dÃ©clarÃ©s par les 547 dÃ©putÃ©s franÃ§ais â€” donnÃ©es HATVP open data.">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css?v=2">

  <!-- D3.js + Sankey plugin -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>

  <!-- DonnÃ©es embarquÃ©es (gÃ©nÃ©rÃ©es par fetch_data.py) -->
  <script src="data.js"></script>

</head>
<body>

<header>
  <div class="header-brand">
    <h1><span class="brand-icon">ğŸ›</span> Open Mandats</h1>
    <p>Participations financiÃ¨res et intÃ©rÃªts dÃ©clarÃ©s par les 547 dÃ©putÃ©s de la 17Ã¨me lÃ©gislature Â· Source : HATVP open data (DIA) Â· Groupes : assemblee-nationale.fr</p>
  </div>
  <div class="header-right">
    <div id="status" aria-live="polite">Chargement...</div>
    <button id="theme-toggle" onclick="toggleTheme()" title="Basculer mode clair / sombre">â˜€ï¸ Mode clair</button>
  </div>
</header>

<!-- Barre sticky : toggle bourse + filtres actifs -->
<div id="sticky-bar">
  <div id="bourse-toggle-bar">
    <button class="bourse-toggle" id="bourse-toggle-btn" onclick="toggleBourse()">
      ğŸ“ˆ Bourse uniquement
    </button>
    <span class="bourse-toggle-hint">Exclut SCI, SARL, SAS et structures privÃ©es</span>
  </div>
  <div id="filter-bar" aria-live="polite">
    <span class="filter-bar-label">Filtres :</span>
    <div id="filter-bar-tags"></div>
    <button class="filter-bar-clear" id="filter-bar-clear-btn" onclick="clearFilter()">âœ• Tout effacer</button>
  </div>
</div>

<main>

  <!-- Onglets -->
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('graphiques', this)">ğŸ“Š Graphiques</button>
    <button class="tab-btn" onclick="switchTab('sankey', this)">ğŸ”€ Sankey</button>
  </div>

  <!-- â•â•â•â• ONGLET GRAPHIQUES â•â•â•â• -->
  <div class="tab-panel active" id="tab-graphiques">

  <!-- Statistiques globales -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="value" id="stat-deputes">â€”</div>
      <div class="label" id="stat-deputes-label">DÃ©putÃ©s avec DIA publiÃ©e</div>
    </div>
    <div class="stat-card">
      <div class="value" id="stat-valeur">â€”</div>
      <div class="label">Valeur totale dÃ©clarÃ©e</div>
    </div>
    <div class="stat-card">
      <div class="value" id="stat-moyenne">â€”</div>
      <div class="label">Valeur moyenne dÃ©clarÃ©e</div>
    </div>
    <div class="stat-card">
      <div class="value" id="stat-mediane">â€”</div>
      <div class="label">Valeur mÃ©diane dÃ©clarÃ©e</div>
    </div>
  </div>

  <!-- Ligne 1 : grille 12 colonnes â€” bar valeur (3) + sunburst (9) -->
  <div class="grid-12" style="margin-bottom:14px">

    <div class="chart-card col-3">
      <h2 id="title-valeur-groupe">Valeur totale par groupe (Mâ‚¬)</h2>
      <div class="chart-wrap" id="bar-valeur-groupe-wrap"></div>
    </div>

    <div class="chart-card col-9">
      <h2>
        Explorer : Groupes â†’ DÃ©putÃ©s
        <small>(cliquez pour filtrer)</small>
      </h2>
      <div class="chart-wrap" id="sunburst-wrap" role="img" aria-label="Sunburst interactif : groupes politiques et dÃ©putÃ©s"></div>
    </div>

  </div>

  <!-- Graphiques secondaires -->
  <div class="charts-grid">

    <div class="chart-card full">
      <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:8px">
        <h2 id="title-societes" style="margin:0;flex:1;border:none;padding:0">SociÃ©tÃ©s â€” valeur en Mâ‚¬ par groupe politique</h2>
        <div id="societes-picker" class="soc-picker">
          <div class="soc-picker-input-row">
            <input type="text" id="search-societes" class="search-input soc-picker-input"
                   placeholder="ğŸ” Filtrer une sociÃ©tÃ©..."
                   oninput="socPickerOnInput()"
                   onfocus="socPickerOpen()"
                   autocomplete="off"
                   style="width:240px;margin:0">
            <button class="soc-picker-clear" id="soc-picker-clear" onclick="socPickerClearAll()" title="Effacer la sÃ©lection" style="display:none">âœ•</button>
          </div>
          <ul class="soc-picker-dropdown" id="soc-picker-dropdown" style="display:none"></ul>
          <div class="soc-picker-tags" id="soc-picker-tags"></div>
        </div>
      </div>
      <div style="height:1px;background:var(--border);margin-bottom:16px"></div>
      <div class="chart-wrap" id="bar-societes-wrap" style="max-height:560px;overflow-y:auto;overflow-x:hidden"></div>
    </div>

  </div>

  <!-- Table -->
  <div class="table-card" id="table-section">
    <h2>
      DÃ©tail par dÃ©putÃ©
      <input type="search" class="search-input" id="search" placeholder="ğŸ” DÃ©putÃ©, sociÃ©tÃ©..."
             aria-label="Rechercher un dÃ©putÃ© ou une sociÃ©tÃ©">
    </h2>
    <div style="overflow-x:auto">
      <table>
        <thead id="table-head">
          <tr>
            <th onclick="sortTable('nom')">DÃ©putÃ© <span id="s-nom"></span></th>
            <th onclick="sortTable('groupe')">Groupe <span id="s-groupe"></span></th>
            <th onclick="sortTable('departement')">DÃ©p. <span id="s-departement"></span></th>
            <th onclick="sortTable('nbParts')">Participations <span id="s-nbParts"></span></th>
            <th onclick="sortTable('valeurTotale')">Valeur totale <span id="s-valeurTotale"></span></th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
    <div class="pagination" id="pagination" role="navigation" aria-label="Pagination"></div>
    <p class="note">
      Sources :
      <a href="https://www.hatvp.fr/consulter-les-declarations/#open-data" target="_blank" rel="noopener">HATVP open data</a> Â·
      <a href="https://www.assemblee-nationale.fr" target="_blank" rel="noopener">assemblee-nationale.fr</a> Â·
      Uniquement les DIA publiÃ©es Â· "DonnÃ©es non publiÃ©es" = sociÃ©tÃ©s anonymisÃ©es par la HATVP
    </p>
  </div>

  </div><!-- /tab-graphiques -->

  <!-- â•â•â•â• ONGLET SANKEY â•â•â•â• -->
  <div class="tab-panel" id="tab-sankey">
    <div class="chart-card full">
      <h2>
        Flux financiers : Groupes â†’ DÃ©putÃ©s â†’ SociÃ©tÃ©s
        <small>(en Mâ‚¬ Â· cliquez sur un nÅ“ud pour filtrer)</small>
      </h2>
      <div class="sankey-controls">
        <label>Top sociÃ©tÃ©s :
          <select id="sankey-top-n" onchange="rebuildSankey()">
            <option value="15">Top 15</option>
            <option value="25" selected>Top 25</option>
            <option value="50">Top 50</option>
            <option value="9999">Toutes</option>
          </select>
        </label>
        <label>Valeur min. par lien :
          <select id="sankey-min-val" onchange="rebuildSankey()">
            <option value="0">Toutes</option>
            <option value="100000">â‰¥ 100kâ‚¬</option>
            <option value="500000" selected>â‰¥ 500kâ‚¬</option>
            <option value="1000000">â‰¥ 1Mâ‚¬</option>
            <option value="5000000">â‰¥ 5Mâ‚¬</option>
          </select>
        </label>
        <label>Groupe :
          <select id="sankey-groupe" onchange="rebuildSankey()">
            <option value="">Tous</option>
          </select>
        </label>
      </div>
      <div id="sankey-wrap"></div>
    </div>
  </div><!-- /tab-sankey -->

</main>

<!-- Tooltip -->
<div id="tooltip" role="tooltip" aria-hidden="true"></div>

<!-- App -->
<script src="app.js" defer></script>
<script src="sankey.js" defer></script>

</body>
</html>
